{
  "name": "Specification Refinement Protocol",
  "description": "Refines the canonical protocol document to make Section 7 machine-readable and ready for Autopoietic Genesis.",
  "tasks": {
    "ingest_current_protocol": {
      "description": "Read the current canonical protocol file.",
      "action_type": "read_file",
      "inputs": {
        "file_path": "ResonantiA_Protocol_v3.1-CA.md"
      },
      "dependencies": []
    },
    "define_strict_schema": {
      "description": "Define a strict, machine-readable schema for a file specification.",
      "action_type": "execute_code",
      "inputs": {
        "language": "python",
        "code": "import json; print(json.dumps({'schema': {'file_path': 'string', 'specification': 'string', 'dependencies': ['string'], 'classes': [{'class_name': 'string', 'methods': ['string']}]}}))"
      },
      "dependencies": []
    },
    "rewrite_section_7": {
      "description": "Use an LLM to rewrite Section 7 to conform to the strict schema.",
      "action_type": "generate_text_llm",
      "inputs": {
        "prompt": "Analyze the provided ResonantiA Protocol text. Find 'Section 7: Codebase & File Definitions'. For EACH numbered subsection, transform its content into a JSON object that strictly conforms to the following schema: {{ define_strict_schema.output.schema }}. Output ONLY a valid JSON array of these objects.",
        "model": "gemini-2.5-pro",
        "max_tokens": 16000,
        "temperature": 0.0
      },
      "dependencies": ["ingest_current_protocol", "define_strict_schema"]
    },
    "validate_refined_specification": {
      "description": "Validate the rewritten specification against the schema.",
      "action_type": "execute_code",
      "inputs": {
        "language": "python",
        "input_data": "{{ rewrite_section_7.response_text }}",
        "code": "import json, sys; schema = {{ define_strict_schema.output.schema | to_json }}; specs = json.loads(sys.stdin.read()); # Basic validation logic here... print(json.dumps({'validation_status': 'success'}))"
      },
      "dependencies": ["rewrite_section_7"]
    },
    "canonize_new_protocol": {
      "description": "Save the new, refined protocol document.",
      "action_type": "create_file",
      "inputs": {
        "file_path": "ResonantiA_Protocol_v3.2-SR.md",
        "content": "# ResonantiA Protocol v3.2-SR (Specification Refinement)\\n\\n## Section 7: Codebase & File Definitions (Machine-Readable)\\n\\n```json\\n{{ rewrite_section_7.response_text }}\\n```"
      },
      "dependencies": ["validate_refined_specification"]
    }
  },
  "start_tasks": ["ingest_current_protocol", "define_strict_schema"]
}
